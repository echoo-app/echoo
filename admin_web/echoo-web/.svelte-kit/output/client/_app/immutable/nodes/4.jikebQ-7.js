import{s as Ue,i as Ct,n as _e,r as Ie,o as Ge}from"../chunks/scheduler.BvLojk_z.js";import{S as Be,i as Oe,e as h,s as V,u as Me,c as _,m as J,h as M,n as c,j as A,p as he,q as Z,g as u,d as w,o as Xe,b as U,f as B,k as a,l as X,D as ve,E as wt,a as Ne,v as yt,t as Se,x as It,z as Fe,A as Je,B as Qe,C as We}from"../chunks/index.cf6qNKHt.js";import{g as Ve}from"../chunks/entry.7PKGXZch.js";import{e as ye,u as Tt,d as Dt}from"../chunks/each.CYtoICLu.js";function xe(n,e,t){const s=n.slice();return s[12]=e[t],s}function Pt(n){let e,t,s,l=ye(n[6]),o=[];for(let i=0;i<l.length;i+=1)o[i]=$e(xe(n,l,i));let r=n[4]&&et(n);return{c(){e=h("ul");for(let i=0;i<o.length;i+=1)o[i].c();t=V(),r&&r.c(),s=Me(),this.h()},l(i){e=_(i,"UL",{class:!0});var p=w(e);for(let m=0;m<o.length;m+=1)o[m].l(p);p.forEach(u),t=M(i),r&&r.l(i),s=Me(),this.h()},h(){c(e,"class","models-list")},m(i,p){A(i,e,p);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(e,null);A(i,t,p),r&&r.m(i,p),A(i,s,p)},p(i,p){if(p&200){l=ye(i[6]);let m;for(m=0;m<l.length;m+=1){const y=xe(i,l,m);o[m]?o[m].p(y,p):(o[m]=$e(y),o[m].c(),o[m].m(e,null))}for(;m<o.length;m+=1)o[m].d(1);o.length=l.length}i[4]?r?r.p(i,p):(r=et(i),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null)},d(i){i&&(u(e),u(t),u(s)),Xe(o,i),r&&r.d(i)}}}function Vt(n){let e,t="<p>未找到匹配的模型</p>";return{c(){e=h("div"),e.innerHTML=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-enc6qs"&&(e.innerHTML=t),this.h()},h(){c(e,"class","status-card empty")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function Mt(n){let e,t,s;return{c(){e=h("div"),t=h("p"),s=U(n[2]),this.h()},l(l){e=_(l,"DIV",{class:!0});var o=w(e);t=_(o,"P",{});var r=w(t);s=B(r,n[2]),r.forEach(u),o.forEach(u),this.h()},h(){c(e,"class","status-card error")},m(l,o){A(l,e,o),a(e,t),a(t,s)},p(l,o){o&4&&X(s,l[2])},d(l){l&&u(e)}}}function Nt(n){let e,t="<p>加载模型列表中...</p>";return{c(){e=h("div"),e.innerHTML=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1rusq70"&&(e.innerHTML=t),this.h()},h(){c(e,"class","status-card loading")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function $e(n){let e,t,s,l=n[12].name+"",o,r,i,p,m,y=qe(n[12].pricing.prompt)+"",g,b,C,E,d=qe(n[12].pricing.completion)+"",k,T,P,I,N=tt(n[12].pricing.image)+"",f,v,D,z=n[3].includes(n[12].id)?"已选择":"选择",L,S,O,W;function F(){return n[11](n[12])}return{c(){e=h("li"),t=h("div"),s=h("span"),o=U(l),r=V(),i=h("div"),p=h("span"),m=U("输入: "),g=U(y),b=V(),C=h("span"),E=U("输出: "),k=U(d),T=V(),P=h("span"),I=U("图片: "),f=U(N),v=V(),D=h("button"),L=U(z),S=V(),this.h()},l(H){e=_(H,"LI",{});var K=w(e);t=_(K,"DIV",{class:!0});var j=w(t);s=_(j,"SPAN",{class:!0});var Y=w(s);o=B(Y,l),Y.forEach(u),r=M(j),i=_(j,"DIV",{class:!0});var ee=w(i);p=_(ee,"SPAN",{});var G=w(p);m=B(G,"输入: "),g=B(G,y),G.forEach(u),b=M(ee),C=_(ee,"SPAN",{});var ce=w(C);E=B(ce,"输出: "),k=B(ce,d),ce.forEach(u),T=M(ee),P=_(ee,"SPAN",{});var q=w(P);I=B(q,"图片: "),f=B(q,N),q.forEach(u),ee.forEach(u),j.forEach(u),v=M(K),D=_(K,"BUTTON",{class:!0});var Q=w(D);L=B(Q,z),Q.forEach(u),S=M(K),K.forEach(u),this.h()},h(){c(s,"class","model-name"),c(i,"class","model-price"),c(t,"class","model-info"),c(D,"class","select-btn"),ve(D,"selected",n[3].includes(n[12].id)),ve(e,"selected",n[3].includes(n[12].id))},m(H,K){A(H,e,K),a(e,t),a(t,s),a(s,o),a(t,r),a(t,i),a(i,p),a(p,m),a(p,g),a(i,b),a(i,C),a(C,E),a(C,k),a(i,T),a(i,P),a(P,I),a(P,f),a(e,v),a(e,D),a(D,L),a(e,S),O||(W=Z(D,"click",F),O=!0)},p(H,K){n=H,K&64&&l!==(l=n[12].name+"")&&X(o,l),K&64&&y!==(y=qe(n[12].pricing.prompt)+"")&&X(g,y),K&64&&d!==(d=qe(n[12].pricing.completion)+"")&&X(k,d),K&64&&N!==(N=tt(n[12].pricing.image)+"")&&X(f,N),K&72&&z!==(z=n[3].includes(n[12].id)?"已选择":"选择")&&X(L,z),K&72&&ve(D,"selected",n[3].includes(n[12].id)),K&72&&ve(e,"selected",n[3].includes(n[12].id))},d(H){H&&u(e),O=!1,W()}}}function et(n){let e,t;return{c(){e=h("p"),t=U(n[4]),this.h()},l(s){e=_(s,"P",{class:!0});var l=w(e);t=B(l,n[4]),l.forEach(u),this.h()},h(){c(e,"class","message")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&16&&X(t,s[4])},d(s){s&&u(e)}}}function St(n){let e,t="选择模型",s,l,o="刷新列表",r,i,p,m,y,g;function b(d,k){return d[1]?Nt:d[2]?Mt:d[6].length===0?Vt:Pt}let C=b(n),E=C(n);return{c(){e=h("h3"),e.textContent=t,s=V(),l=h("button"),l.textContent=o,r=V(),i=h("input"),p=V(),E.c(),m=Me(),this.h()},l(d){e=_(d,"H3",{"data-svelte-h":!0}),J(e)!=="svelte-16k5uqq"&&(e.textContent=t),s=M(d),l=_(d,"BUTTON",{class:!0,"data-svelte-h":!0}),J(l)!=="svelte-1uz2amx"&&(l.textContent=o),r=M(d),i=_(d,"INPUT",{type:!0,placeholder:!0,class:!0}),p=M(d),E.l(d),m=Me(),this.h()},h(){c(l,"class","refresh-btn"),c(i,"type","text"),c(i,"placeholder","搜索模型..."),c(i,"class","search-input")},m(d,k){A(d,e,k),A(d,s,k),A(d,l,k),A(d,r,k),A(d,i,k),he(i,n[0]),A(d,p,k),E.m(d,k),A(d,m,k),y||(g=[Z(l,"click",function(){Ct(n[5])&&n[5].apply(this,arguments)}),Z(i,"input",n[10])],y=!0)},p(d,[k]){n=d,k&1&&i.value!==n[0]&&he(i,n[0]),C===(C=b(n))&&E?E.p(n,k):(E.d(1),E=C(n),E&&(E.c(),E.m(m.parentNode,m)))},i:_e,o:_e,d(d){d&&(u(e),u(s),u(l),u(r),u(i),u(p),u(m)),E.d(d),y=!1,Ie(g)}}}function qe(n){return`$${(parseFloat(n)*1e6).toFixed(2)}/1M tokens`}function tt(n){if(!n)return"不支持图片生成";const e=parseFloat(n);return isNaN(e)?"不支持图片生成":`$${(e*1e3).toFixed(2)}/K imgs`}function At(n,e,t){let s,{models:l}=e,{loading:o}=e,{error:r}=e,{savedModelIds:i}=e,{modelMessage:p}=e,{searchQuery:m}=e,{onRefresh:y}=e,{onToggleModel:g}=e;function b(d){i.includes(d)||g([d])}function C(){m=this.value,t(0,m)}const E=d=>b(d.id);return n.$$set=d=>{"models"in d&&t(8,l=d.models),"loading"in d&&t(1,o=d.loading),"error"in d&&t(2,r=d.error),"savedModelIds"in d&&t(3,i=d.savedModelIds),"modelMessage"in d&&t(4,p=d.modelMessage),"searchQuery"in d&&t(0,m=d.searchQuery),"onRefresh"in d&&t(5,y=d.onRefresh),"onToggleModel"in d&&t(9,g=d.onToggleModel)},n.$$.update=()=>{n.$$.dirty&257&&t(6,s=l.filter(d=>d.name.toLowerCase().includes(m.toLowerCase())||d.id.toLowerCase().includes(m.toLowerCase())).sort((d,k)=>d.name.localeCompare(k.name)))},[m,o,r,i,p,y,s,b,l,g,C,E]}class Lt extends Be{constructor(e){super(),Oe(this,e,At,St,Ue,{models:8,loading:1,error:2,savedModelIds:3,modelMessage:4,searchQuery:0,onRefresh:5,onToggleModel:9})}}function st(n,e,t){const s=n.slice();return s[18]=e[t],s}function lt(n){let e,t;return{c(){e=h("div"),t=U(n[4]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[4]),l.forEach(u),this.h()},h(){c(e,"class","message success")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&16&&X(t,s[4])},d(s){s&&u(e)}}}function nt(n){let e,t;return{c(){e=h("div"),t=U(n[2]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[2]),l.forEach(u),this.h()},h(){c(e,"class","message error")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&4&&X(t,s[2])},d(s){s&&u(e)}}}function Ut(n){let e,t=ye(n[7]),s=[];for(let l=0;l<t.length;l+=1)s[l]=rt(st(n,t,l));return{c(){e=h("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=_(l,"DIV",{class:!0});var o=w(e);for(let r=0;r<s.length;r+=1)s[r].l(o);o.forEach(u),this.h()},h(){c(e,"class","user-list")},m(l,o){A(l,e,o);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(l,o){if(o&4064){t=ye(l[7]);let r;for(r=0;r<t.length;r+=1){const i=st(l,t,r);s[r]?s[r].p(i,o):(s[r]=rt(i),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(l){l&&u(e),Xe(s,l)}}}function Bt(n){let e,t,s=n[0].length===0?"暂无用户数据":"未找到匹配的用户",l;return{c(){e=h("div"),t=h("p"),l=U(s),this.h()},l(o){e=_(o,"DIV",{class:!0});var r=w(e);t=_(r,"P",{});var i=w(t);l=B(i,s),i.forEach(u),r.forEach(u),this.h()},h(){c(e,"class","status-card")},m(o,r){A(o,e,r),a(e,t),a(t,l)},p(o,r){r&1&&s!==(s=o[0].length===0?"暂无用户数据":"未找到匹配的用户")&&X(l,s)},d(o){o&&u(e)}}}function Ot(n){let e,t="<p>加载用户列表中...</p>";return{c(){e=h("div"),e.innerHTML=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1pjym57"&&(e.innerHTML=t),this.h()},h(){c(e,"class","status-card loading")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function jt(n){let e,t,s=n[18].username+"",l,o,r,i,p=n[18].id+"",m,y,g,b,C,E=n[18].api_calls+"",d,k,T,P,I=at(n[18].created_at)+"",N,f,v,D,z="编辑",L,S,O="删除",W,F;function H(){return n[14](n[18])}function K(){return n[15](n[18])}return{c(){e=h("div"),t=h("h4"),l=U(s),o=V(),r=h("span"),i=U("ID: "),m=U(p),y=V(),g=h("div"),b=h("p"),C=U("调用次数: "),d=U(E),k=V(),T=h("p"),P=U("创建时间: "),N=U(I),f=V(),v=h("div"),D=h("button"),D.textContent=z,L=V(),S=h("button"),S.textContent=O,this.h()},l(j){e=_(j,"DIV",{class:!0});var Y=w(e);t=_(Y,"H4",{});var ee=w(t);l=B(ee,s),ee.forEach(u),o=M(Y),r=_(Y,"SPAN",{class:!0});var G=w(r);i=B(G,"ID: "),m=B(G,p),G.forEach(u),Y.forEach(u),y=M(j),g=_(j,"DIV",{class:!0});var ce=w(g);b=_(ce,"P",{});var q=w(b);C=B(q,"调用次数: "),d=B(q,E),q.forEach(u),k=M(ce),T=_(ce,"P",{});var Q=w(T);P=B(Q,"创建时间: "),N=B(Q,I),Q.forEach(u),ce.forEach(u),f=M(j),v=_(j,"DIV",{class:!0});var x=w(v);D=_(x,"BUTTON",{class:!0,"data-svelte-h":!0}),J(D)!=="svelte-i1fsqh"&&(D.textContent=z),L=M(x),S=_(x,"BUTTON",{class:!0,"data-svelte-h":!0}),J(S)!=="svelte-wnt3p0"&&(S.textContent=O),x.forEach(u),this.h()},h(){c(r,"class","user-id"),c(e,"class","card-header"),c(g,"class","card-details"),c(D,"class","edit-btn"),c(S,"class","delete-btn"),c(v,"class","button-group")},m(j,Y){A(j,e,Y),a(e,t),a(t,l),a(e,o),a(e,r),a(r,i),a(r,m),A(j,y,Y),A(j,g,Y),a(g,b),a(b,C),a(b,d),a(g,k),a(g,T),a(T,P),a(T,N),A(j,f,Y),A(j,v,Y),a(v,D),a(v,L),a(v,S),W||(F=[Z(D,"click",H),Z(S,"click",K)],W=!0)},p(j,Y){n=j,Y&128&&s!==(s=n[18].username+"")&&X(l,s),Y&128&&p!==(p=n[18].id+"")&&X(m,p),Y&128&&E!==(E=n[18].api_calls+"")&&X(d,E),Y&128&&I!==(I=at(n[18].created_at)+"")&&X(N,I)},d(j){j&&(u(e),u(y),u(g),u(f),u(v)),W=!1,Ie(F)}}}function Kt(n){let e,t,s,l=n[18].username+"",o,r,i,p,m=n[18].id+"",y,g,b,C,E="调用次数",d,k,T,P,I,N="保存",f,v,D="取消",z,L;return{c(){e=h("div"),t=h("div"),s=h("h4"),o=U(l),r=V(),i=h("span"),p=U("ID: "),y=U(m),g=V(),b=h("div"),C=h("label"),C.textContent=E,d=V(),k=h("input"),T=V(),P=h("div"),I=h("button"),I.textContent=N,f=V(),v=h("button"),v.textContent=D,this.h()},l(S){e=_(S,"DIV",{class:!0});var O=w(e);t=_(O,"DIV",{class:!0});var W=w(t);s=_(W,"H4",{});var F=w(s);o=B(F,l),F.forEach(u),r=M(W),i=_(W,"SPAN",{class:!0});var H=w(i);p=B(H,"ID: "),y=B(H,m),H.forEach(u),W.forEach(u),g=M(O),b=_(O,"DIV",{class:!0});var K=w(b);C=_(K,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(C)!=="svelte-cx2qz2"&&(C.textContent=E),d=M(K),k=_(K,"INPUT",{type:!0,id:!0,step:!0,class:!0}),K.forEach(u),T=M(O),P=_(O,"DIV",{class:!0});var j=w(P);I=_(j,"BUTTON",{class:!0,"data-svelte-h":!0}),J(I)!=="svelte-1rhjfef"&&(I.textContent=N),f=M(j),v=_(j,"BUTTON",{class:!0,"data-svelte-h":!0}),J(v)!=="svelte-15qpfze"&&(v.textContent=D),j.forEach(u),O.forEach(u),this.h()},h(){c(i,"class","user-id"),c(t,"class","card-header"),c(C,"for","api_calls"),c(C,"class","svelte-2cshg6"),c(k,"type","number"),c(k,"id","api_calls"),c(k,"step","1"),c(k,"class","input svelte-2cshg6"),c(b,"class","form-group svelte-2cshg6"),c(I,"class","save-btn"),c(v,"class","cancel-btn"),c(P,"class","button-group"),c(e,"class","edit-form svelte-2cshg6")},m(S,O){A(S,e,O),a(e,t),a(t,s),a(s,o),a(t,r),a(t,i),a(i,p),a(i,y),a(e,g),a(e,b),a(b,C),a(b,d),a(b,k),he(k,n[6]),a(e,T),a(e,P),a(P,I),a(P,f),a(P,v),z||(L=[Z(k,"input",n[13]),Z(I,"click",n[10]),Z(v,"click",n[9])],z=!0)},p(S,O){O&128&&l!==(l=S[18].username+"")&&X(o,l),O&128&&m!==(m=S[18].id+"")&&X(y,m),O&64&&wt(k.value)!==S[6]&&he(k,S[6])},d(S){S&&u(e),z=!1,Ie(L)}}}function rt(n){let e,t;function s(r,i){return r[5]&&r[5].id===r[18].id?Kt:jt}let l=s(n),o=l(n);return{c(){e=h("div"),o.c(),t=V(),this.h()},l(r){e=_(r,"DIV",{class:!0});var i=w(e);o.l(i),t=M(i),i.forEach(u),this.h()},h(){c(e,"class","user-card")},m(r,i){A(r,e,i),o.m(e,null),a(e,t)},p(r,i){l===(l=s(r))&&o?o.p(r,i):(o.d(1),o=l(r),o&&(o.c(),o.m(e,t)))},d(r){r&&u(e),o.d()}}}function Ht(n){let e,t,s="用户列表",l,o,r,i,p,m,y,g=n[4]&&lt(n),b=n[2]&&nt(n);function C(k,T){return k[3]?Ot:k[7].length===0?Bt:Ut}let E=C(n),d=E(n);return{c(){e=h("div"),t=h("h3"),t.textContent=s,l=V(),o=h("input"),r=V(),g&&g.c(),i=V(),b&&b.c(),p=V(),d.c(),this.h()},l(k){e=_(k,"DIV",{class:!0});var T=w(e);t=_(T,"H3",{"data-svelte-h":!0}),J(t)!=="svelte-1izetd2"&&(t.textContent=s),l=M(T),o=_(T,"INPUT",{type:!0,placeholder:!0,class:!0}),r=M(T),g&&g.l(T),i=M(T),b&&b.l(T),p=M(T),d.l(T),T.forEach(u),this.h()},h(){c(o,"type","text"),c(o,"placeholder","搜索用户名或ID..."),c(o,"class","search-input"),c(e,"class","user-list-container")},m(k,T){A(k,e,T),a(e,t),a(e,l),a(e,o),he(o,n[1]),a(e,r),g&&g.m(e,null),a(e,i),b&&b.m(e,null),a(e,p),d.m(e,null),m||(y=Z(o,"input",n[12]),m=!0)},p(k,[T]){T&2&&o.value!==k[1]&&he(o,k[1]),k[4]?g?g.p(k,T):(g=lt(k),g.c(),g.m(e,i)):g&&(g.d(1),g=null),k[2]?b?b.p(k,T):(b=nt(k),b.c(),b.m(e,p)):b&&(b.d(1),b=null),E===(E=C(k))&&d?d.p(k,T):(d.d(1),d=E(k),d&&(d.c(),d.m(e,null)))},i:_e,o:_e,d(k){k&&u(e),g&&g.d(),b&&b.d(),d.d(),m=!1,y()}}}function at(n){return new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function zt(n,e,t){let s,l=[],o=null,r=!1,i="",p="",m=null,y="";Ge(async()=>{await b()});async function g(f,v={}){const z={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},L=await fetch(f,{...v,headers:{...z,...v.headers}});if(L.status===401)throw Ve("/bde"),new Error("未认证");return L}async function b(){try{t(3,r=!0);const f=await g("/api/users");if(!f.ok){const v=await f.json();throw new Error(v.error||"获取用户列表失败")}t(0,l=await f.json())}catch(f){console.error("获取用户列表错误:",f),t(2,o=f instanceof Error?f.message:"未知错误")}finally{t(3,r=!1)}}function C(f){t(5,m=f),t(6,y=f.api_calls.toString())}function E(){t(5,m=null),t(6,y="")}async function d(){if(m){try{const f=await g(`/api/users/${m.id}/api-calls`,{method:"POST",body:JSON.stringify({api_calls:parseInt(y)})});if(!f.ok){const v=await f.json();throw new Error(v.error||"更新用户信息失败")}t(4,p="用户信息更新成功"),await b(),E()}catch(f){console.error("更新用户信息错误:",f),t(2,o=f instanceof Error?f.message:"未知错误")}setTimeout(()=>{t(4,p=""),t(2,o=null)},3e3)}}async function k(f){if(confirm("确定要删除此用户吗？此操作不可撤销。")){try{const v=await g(`/api/users/${f}`,{method:"DELETE"});if(v.status===204)t(4,p="用户已删除"),await b();else{const D=await v.json();throw new Error(D.error||"删除用户失败")}}catch(v){console.error("删除用户错误:",v),t(2,o=v instanceof Error?v.message:"未知错误")}setTimeout(()=>{t(4,p=""),t(2,o=null)},3e3)}}function T(){i=this.value,t(1,i)}function P(){y=wt(this.value),t(6,y)}const I=f=>C(f),N=f=>k(f.id);return n.$$.update=()=>{n.$$.dirty&3&&t(7,s=l.filter(f=>f.username.toLowerCase().includes(i.toLowerCase())||f.id.toString().includes(i)))},[l,i,o,r,p,m,y,s,C,E,d,k,T,P,I,N]}class qt extends Be{constructor(e){super(),Oe(this,e,zt,Ht,Ue,{})}}function ot(n,e,t){const s=n.slice();return s[18]=e[t],s}function it(n){let e,t;return{c(){e=h("div"),t=U(n[2]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[2]),l.forEach(u),this.h()},h(){c(e,"class","message error")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&4&&X(t,s[2])},d(s){s&&u(e)}}}function ct(n){let e,t;return{c(){e=h("div"),t=U(n[3]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[3]),l.forEach(u),this.h()},h(){c(e,"class","message success")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&8&&X(t,s[3])},d(s){s&&u(e)}}}function Rt(n){let e,t=[],s=new Map,l=ye(n[0]);const o=r=>r[18].id;for(let r=0;r<l.length;r+=1){let i=ot(n,l,r),p=o(i);s.set(p,t[r]=ht(p,i))}return{c(){e=h("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=_(r,"DIV",{class:!0});var i=w(e);for(let p=0;p<t.length;p+=1)t[p].l(i);i.forEach(u),this.h()},h(){c(e,"class","user-list vip-codes")},m(r,i){A(r,e,i);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null)},p(r,i){i&2635&&(l=ye(r[0]),t=Tt(t,i,o,1,r,l,s,e,Dt,ht,null,ot))},d(r){r&&u(e);for(let i=0;i<t.length;i+=1)t[i].d()}}}function Ft(n){let e,t="暂无激活码";return{c(){e=h("div"),e.textContent=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-nvz1t0"&&(e.textContent=t),this.h()},h(){c(e,"class","status-card")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function Jt(n){let e,t="加载中...";return{c(){e=h("div"),e.textContent=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1j25vsg"&&(e.textContent=t),this.h()},h(){c(e,"class","status-card loading")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function ut(n){let e,t,s=new Date(n[18].used_at).toLocaleString()+"",l;return{c(){e=h("p"),t=U("使用时间: "),l=U(s)},l(o){e=_(o,"P",{});var r=w(e);t=B(r,"使用时间: "),l=B(r,s),r.forEach(u)},m(o,r){A(o,e,r),a(e,t),a(e,l)},p(o,r){r&1&&s!==(s=new Date(o[18].used_at).toLocaleString()+"")&&X(l,s)},d(o){o&&u(e)}}}function ft(n){let e,t,s=new Date(n[18].payment_url_expires_at).toLocaleString()+"",l;return{c(){e=h("span"),t=U("过期时间: "),l=U(s),this.h()},l(o){e=_(o,"SPAN",{class:!0});var r=w(e);t=B(r,"过期时间: "),l=B(r,s),r.forEach(u),this.h()},h(){c(e,"class","expires")},m(o,r){A(o,e,r),a(e,t),a(e,l)},p(o,r){r&1&&s!==(s=new Date(o[18].payment_url_expires_at).toLocaleString()+"")&&X(l,s)},d(o){o&&u(e)}}}function dt(n){let e,t,s,l,o=n[18].enabled?"禁用":"启用",r,i,p,m;function y(){return n[13](n[18])}function g(){return n[14](n[18])}return{c(){e=h("button"),t=U("编辑链接"),s=V(),l=h("button"),r=U(o),this.h()},l(b){e=_(b,"BUTTON",{class:!0});var C=w(e);t=B(C,"编辑链接"),C.forEach(u),s=M(b),l=_(b,"BUTTON",{class:!0});var E=w(l);r=B(E,o),E.forEach(u),this.h()},h(){c(e,"class","edit-btn"),e.disabled=n[1],c(l,"class",i=n[18].enabled?"delete-btn":"edit-btn"),l.disabled=n[1]},m(b,C){A(b,e,C),a(e,t),A(b,s,C),A(b,l,C),a(l,r),p||(m=[Z(e,"click",y),Z(l,"click",g)],p=!0)},p(b,C){n=b,C&2&&(e.disabled=n[1]),C&1&&o!==(o=n[18].enabled?"禁用":"启用")&&X(r,o),C&1&&i!==(i=n[18].enabled?"delete-btn":"edit-btn")&&c(l,"class",i),C&2&&(l.disabled=n[1])},d(b){b&&(u(e),u(s),u(l)),p=!1,Ie(m)}}}function ht(n,e){let t,s,l,o=e[18].code+"",r,i,p,m,y=e[18].enabled?"已启用":"已禁用",g,b,C,E,d=e[18].used?"已使用":"未使用",k,T,P,I,N,f,v=new Date(e[18].created_at).toLocaleString()+"",D,z,L,S,O,W="支付链接:",F,H,K,j=e[18].payment_url+"",Y,ee,G,ce="复制",q,Q,x,fe,le,de,pe,ge,me,te=e[18].used&&ut(e);function je(){return e[12](e[18])}let ae=e[18].payment_url_expires_at&&ft(e),se=!e[18].used&&dt(e);function Ae(){return e[15](e[18])}return{key:n,first:null,c(){t=h("div"),s=h("div"),l=h("h4"),r=U(o),i=V(),p=h("div"),m=h("span"),g=U(y),C=V(),E=h("span"),k=U(d),P=V(),I=h("div"),N=h("p"),f=U("创建于: "),D=U(v),z=V(),te&&te.c(),L=V(),S=h("div"),O=h("span"),O.textContent=W,F=V(),H=h("div"),K=h("span"),Y=U(j),ee=V(),G=h("button"),G.textContent=ce,q=V(),ae&&ae.c(),Q=V(),x=h("div"),se&&se.c(),fe=V(),le=h("button"),de=U("删除"),pe=V(),this.h()},l(be){t=_(be,"DIV",{class:!0});var R=w(t);s=_(R,"DIV",{class:!0});var ne=w(s);l=_(ne,"H4",{});var oe=w(l);r=B(oe,o),oe.forEach(u),i=M(ne),p=_(ne,"DIV",{class:!0});var re=w(p);m=_(re,"SPAN",{class:!0});var Le=w(m);g=B(Le,y),Le.forEach(u),C=M(re),E=_(re,"SPAN",{class:!0});var Te=w(E);k=B(Te,d),Te.forEach(u),re.forEach(u),ne.forEach(u),P=M(R),I=_(R,"DIV",{class:!0});var ie=w(I);N=_(ie,"P",{});var ue=w(N);f=B(ue,"创建于: "),D=B(ue,v),ue.forEach(u),z=M(ie),te&&te.l(ie),L=M(ie),S=_(ie,"DIV",{class:!0});var $=w(S);O=_($,"SPAN",{class:!0,"data-svelte-h":!0}),J(O)!=="svelte-13qwatr"&&(O.textContent=W),F=M($),H=_($,"DIV",{class:!0});var ke=w(H);K=_(ke,"SPAN",{class:!0});var De=w(K);Y=B(De,j),De.forEach(u),ee=M(ke),G=_(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),J(G)!=="svelte-1wafoiq"&&(G.textContent=ce),ke.forEach(u),q=M($),ae&&ae.l($),$.forEach(u),ie.forEach(u),Q=M(R),x=_(R,"DIV",{class:!0});var Ee=w(x);se&&se.l(Ee),fe=M(Ee),le=_(Ee,"BUTTON",{class:!0});var Pe=w(le);de=B(Pe,"删除"),Pe.forEach(u),Ee.forEach(u),pe=M(R),R.forEach(u),this.h()},h(){c(m,"class",b="badge "+(e[18].enabled?"enabled":"disabled")),c(E,"class",T="badge "+(e[18].used?"used":"unused")),c(p,"class","status-badges"),c(s,"class","card-header"),c(O,"class","label"),c(K,"class","url"),c(G,"class","copy-btn"),c(H,"class","url-container"),c(S,"class","payment-url"),c(I,"class","card-details"),c(le,"class","delete-btn"),le.disabled=e[1],c(x,"class","button-group"),c(t,"class","user-card"),this.first=t},m(be,R){A(be,t,R),a(t,s),a(s,l),a(l,r),a(s,i),a(s,p),a(p,m),a(m,g),a(p,C),a(p,E),a(E,k),a(t,P),a(t,I),a(I,N),a(N,f),a(N,D),a(I,z),te&&te.m(I,null),a(I,L),a(I,S),a(S,O),a(S,F),a(S,H),a(H,K),a(K,Y),a(H,ee),a(H,G),a(S,q),ae&&ae.m(S,null),a(t,Q),a(t,x),se&&se.m(x,null),a(x,fe),a(x,le),a(le,de),a(t,pe),ge||(me=[Z(G,"click",je),Z(le,"click",Ae)],ge=!0)},p(be,R){e=be,R&1&&o!==(o=e[18].code+"")&&X(r,o),R&1&&y!==(y=e[18].enabled?"已启用":"已禁用")&&X(g,y),R&1&&b!==(b="badge "+(e[18].enabled?"enabled":"disabled"))&&c(m,"class",b),R&1&&d!==(d=e[18].used?"已使用":"未使用")&&X(k,d),R&1&&T!==(T="badge "+(e[18].used?"used":"unused"))&&c(E,"class",T),R&1&&v!==(v=new Date(e[18].created_at).toLocaleString()+"")&&X(D,v),e[18].used?te?te.p(e,R):(te=ut(e),te.c(),te.m(I,L)):te&&(te.d(1),te=null),R&1&&j!==(j=e[18].payment_url+"")&&X(Y,j),e[18].payment_url_expires_at?ae?ae.p(e,R):(ae=ft(e),ae.c(),ae.m(S,null)):ae&&(ae.d(1),ae=null),e[18].used?se&&(se.d(1),se=null):se?se.p(e,R):(se=dt(e),se.c(),se.m(x,fe)),R&2&&(le.disabled=e[1])},d(be){be&&u(t),te&&te.d(),ae&&ae.d(),se&&se.d(),ge=!1,Ie(me)}}}function _t(n){let e,t,s,l="编辑支付链接",o,r,i,p,m="支付链接",y,g,b,C,E,d="取消",k,T,P="保存",I,N;return{c(){e=h("div"),t=h("div"),s=h("h3"),s.textContent=l,o=V(),r=h("div"),i=h("div"),p=h("label"),p.textContent=m,y=V(),g=h("input"),b=V(),C=h("div"),E=h("button"),E.textContent=d,k=V(),T=h("button"),T.textContent=P,this.h()},l(f){e=_(f,"DIV",{class:!0});var v=w(e);t=_(v,"DIV",{class:!0});var D=w(t);s=_(D,"H3",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-ida47r"&&(s.textContent=l),o=M(D),r=_(D,"DIV",{class:!0});var z=w(r);i=_(z,"DIV",{class:!0});var L=w(i);p=_(L,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(p)!=="svelte-1kflc5c"&&(p.textContent=m),y=M(L),g=_(L,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),L.forEach(u),z.forEach(u),b=M(D),C=_(D,"DIV",{class:!0});var S=w(C);E=_(S,"BUTTON",{class:!0,"data-svelte-h":!0}),J(E)!=="svelte-10e19ky"&&(E.textContent=d),k=M(S),T=_(S,"BUTTON",{class:!0,"data-svelte-h":!0}),J(T)!=="svelte-1f0wnta"&&(T.textContent=P),S.forEach(u),D.forEach(u),v.forEach(u),this.h()},h(){c(s,"class","svelte-mi9t80"),c(p,"for","payment_url"),c(p,"class","svelte-mi9t80"),c(g,"type","text"),c(g,"id","payment_url"),c(g,"placeholder","输入新的支付链接"),c(g,"class","input svelte-mi9t80"),c(i,"class","form-group svelte-mi9t80"),c(r,"class","modal-content svelte-mi9t80"),c(E,"class","cancel-btn svelte-mi9t80"),c(T,"class","save-btn svelte-mi9t80"),c(C,"class","modal-actions svelte-mi9t80"),c(t,"class","modal svelte-mi9t80"),c(e,"class","modal-overlay svelte-mi9t80")},m(f,v){A(f,e,v),a(e,t),a(t,s),a(t,o),a(t,r),a(r,i),a(i,p),a(i,y),a(i,g),he(g,n[5]),a(t,b),a(t,C),a(C,E),a(C,k),a(C,T),I||(N=[Z(g,"input",n[16]),Z(E,"click",n[7]),Z(T,"click",n[10])],I=!0)},p(f,v){v&32&&g.value!==f[5]&&he(g,f[5])},d(f){f&&u(e),I=!1,Ie(N)}}}function Qt(n){let e,t,s="VIP 激活码管理",l,o,r,i,p,m,y,g,b,C,E=n[2]&&it(n),d=n[3]&&ct(n);function k(N,f){return N[1]?Jt:N[0].length===0?Ft:Rt}let T=k(n),P=T(n),I=n[4]&&_t(n);return{c(){e=h("div"),t=h("h3"),t.textContent=s,l=V(),o=h("button"),r=U("生成新激活码"),i=V(),E&&E.c(),p=V(),d&&d.c(),m=V(),P.c(),y=V(),I&&I.c(),g=Me(),this.h()},l(N){e=_(N,"DIV",{});var f=w(e);t=_(f,"H3",{"data-svelte-h":!0}),J(t)!=="svelte-yu26i2"&&(t.textContent=s),l=M(f),o=_(f,"BUTTON",{class:!0});var v=w(o);r=B(v,"生成新激活码"),v.forEach(u),i=M(f),E&&E.l(f),p=M(f),d&&d.l(f),m=M(f),P.l(f),f.forEach(u),y=M(N),I&&I.l(N),g=Me(),this.h()},h(){c(o,"class","refresh-btn"),o.disabled=n[1]},m(N,f){A(N,e,f),a(e,t),a(e,l),a(e,o),a(o,r),a(e,i),E&&E.m(e,null),a(e,p),d&&d.m(e,null),a(e,m),P.m(e,null),A(N,y,f),I&&I.m(N,f),A(N,g,f),b||(C=Z(o,"click",n[8]),b=!0)},p(N,[f]){f&2&&(o.disabled=N[1]),N[2]?E?E.p(N,f):(E=it(N),E.c(),E.m(e,p)):E&&(E.d(1),E=null),N[3]?d?d.p(N,f):(d=ct(N),d.c(),d.m(e,m)):d&&(d.d(1),d=null),T===(T=k(N))&&P?P.p(N,f):(P.d(1),P=T(N),P&&(P.c(),P.m(e,null))),N[4]?I?I.p(N,f):(I=_t(N),I.c(),I.m(g.parentNode,g)):I&&(I.d(1),I=null)},i:_e,o:_e,d(N){N&&(u(e),u(y),u(g)),E&&E.d(),d&&d.d(),P.d(),I&&I.d(N),b=!1,C()}}}function Wt(n,e,t){let s=[],l=!1,o=null,r=null,i=null,p="";function m(f){t(4,i=f),t(5,p=f.payment_url)}function y(){t(4,i=null),t(5,p="")}async function g(){try{t(1,l=!0),t(2,o=null);const f=await fetch("/api/settings/vip-codes",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!f.ok)throw new Error("获取激活码列表失败");const v=await f.json();t(0,s=v.codes)}catch(f){console.error("获取激活码错误:",f),t(2,o=f instanceof Error?f.message:"未知错误")}finally{t(1,l=!1)}}async function b(){try{t(1,l=!0),t(2,o=null);const f=await fetch("/api/settings/vip-codes",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!f.ok)throw new Error("生成激活码失败");const v=await f.json();t(3,r=`已生成新激活码: ${v.code}

支付链接:
${v.payment_url}`),await g()}catch(f){console.error("生成激活码错误:",f),t(2,o=f instanceof Error?f.message:"未知错误")}finally{t(1,l=!1)}}async function C(f,v){try{if(t(1,l=!0),t(2,o=null),!(await fetch(`/api/settings/vip-codes/${f}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({enabled:v})})).ok)throw new Error("更新激活码状态失败");t(3,r="激活码状态已更新"),await g()}catch(D){console.error("更新激活码状态错误:",D),t(2,o=D instanceof Error?D.message:"未知错误")}finally{t(1,l=!1)}}async function E(){if(i)try{if(t(1,l=!0),t(2,o=null),!(await fetch(`/api/settings/vip-codes/${i.code}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({payment_url:p})})).ok)throw new Error("更新支付链接失败");t(3,r="支付链接已更新"),await g(),y()}catch(f){console.error("更新支付链接错误:",f),t(2,o=f instanceof Error?f.message:"未知错误")}finally{t(1,l=!1)}}async function d(f){if(confirm("确定要删除这个激活码吗？"))try{if(t(1,l=!0),t(2,o=null),!(await fetch(`/api/settings/vip-codes/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).ok)throw new Error("删除激活码失败");t(3,r="激活码已删除"),await g()}catch(v){console.error("删除激活码错误:",v),t(2,o=v instanceof Error?v.message:"未知错误")}finally{t(1,l=!1)}}Ge(g);const k=f=>{navigator.clipboard.writeText(f.payment_url),t(3,r="支付链接已复制到剪贴板"),setTimeout(()=>t(3,r=null),3e3)},T=f=>m(f),P=f=>C(f.code,!f.enabled),I=f=>d(f.code);function N(){p=this.value,t(5,p)}return[s,l,o,r,i,p,m,y,b,C,E,d,k,T,P,I,N]}class Gt extends Be{constructor(e){super(),Oe(this,e,Wt,Qt,Ue,{})}}function pt(n,e,t){const s=n.slice();return s[15]=e[t],s}function vt(n){let e,t;return{c(){e=h("p"),t=U(n[1]),this.h()},l(s){e=_(s,"P",{class:!0});var l=w(e);t=B(l,n[1]),l.forEach(u),this.h()},h(){c(e,"class","message success")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&2&&X(t,s[1])},d(s){s&&u(e)}}}function mt(n){let e,t;return{c(){e=h("div"),t=U(n[7]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[7]),l.forEach(u),this.h()},h(){c(e,"class","message success")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&128&&X(t,s[7])},d(s){s&&u(e)}}}function gt(n){let e,t;return{c(){e=h("div"),t=U(n[8]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=B(l,n[8]),l.forEach(u),this.h()},h(){c(e,"class","message error")},m(s,l){A(s,e,l),a(e,t)},p(s,l){l&256&&X(t,s[8])},d(s){s&&u(e)}}}function bt(n){let e,t,s="确认密码",l,o,r,i;return{c(){e=h("div"),t=h("label"),t.textContent=s,l=V(),o=h("input"),this.h()},l(p){e=_(p,"DIV",{class:!0});var m=w(e);t=_(m,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(t)!=="svelte-jhnk48"&&(t.textContent=s),l=M(m),o=_(m,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),m.forEach(u),this.h()},h(){c(t,"for","confirmPassword"),c(t,"class","svelte-1hnfn98"),c(o,"type","password"),c(o,"id","confirmPassword"),c(o,"placeholder","再次输入新密码"),c(o,"class","input svelte-1hnfn98"),c(e,"class","form-group svelte-1hnfn98")},m(p,m){A(p,e,m),a(e,t),a(e,l),a(e,o),he(o,n[6]),r||(i=Z(o,"input",n[13]),r=!0)},p(p,m){m&64&&o.value!==p[6]&&he(o,p[6])},d(p){p&&u(e),r=!1,i()}}}function Xt(n){let e,t=ye(n[3]),s=[];for(let l=0;l<t.length;l+=1)s[l]=kt(pt(n,t,l));return{c(){e=h("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=_(l,"DIV",{class:!0});var o=w(e);for(let r=0;r<s.length;r+=1)s[r].l(o);o.forEach(u),this.h()},h(){c(e,"class","saved-models svelte-1hnfn98")},m(l,o){A(l,e,o);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(l,o){if(o&8){t=ye(l[3]);let r;for(r=0;r<t.length;r+=1){const i=pt(l,t,r);s[r]?s[r].p(i,o):(s[r]=kt(i),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(l){l&&u(e),Xe(s,l)}}}function Yt(n){let e,t="未保存任何模型";return{c(){e=h("div"),e.textContent=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-t77zgt"&&(e.textContent=t),this.h()},h(){c(e,"class","empty-message svelte-1hnfn98")},m(s,l){A(s,e,l)},p:_e,d(s){s&&u(e)}}}function kt(n){let e,t,s=n[15].name+"",l,o,r,i,p,m=Re(n[15].pricing.prompt)+"",y,g,b,C,E=Re(n[15].pricing.completion)+"",d,k,T,P,I=Et(n[15].pricing.image)+"",N,f;return{c(){e=h("div"),t=h("div"),l=U(s),o=V(),r=h("div"),i=h("span"),p=U("输入: "),y=U(m),g=V(),b=h("span"),C=U("输出: "),d=U(E),k=V(),T=h("span"),P=U("图片: "),N=U(I),f=V(),this.h()},l(v){e=_(v,"DIV",{class:!0});var D=w(e);t=_(D,"DIV",{class:!0});var z=w(t);l=B(z,s),z.forEach(u),o=M(D),r=_(D,"DIV",{class:!0});var L=w(r);i=_(L,"SPAN",{});var S=w(i);p=B(S,"输入: "),y=B(S,m),S.forEach(u),g=M(L),b=_(L,"SPAN",{});var O=w(b);C=B(O,"输出: "),d=B(O,E),O.forEach(u),k=M(L),T=_(L,"SPAN",{});var W=w(T);P=B(W,"图片: "),N=B(W,I),W.forEach(u),L.forEach(u),f=M(D),D.forEach(u),this.h()},h(){c(t,"class","saved-model-name svelte-1hnfn98"),c(r,"class","saved-model-price svelte-1hnfn98"),c(e,"class","saved-model svelte-1hnfn98")},m(v,D){A(v,e,D),a(e,t),a(t,l),a(e,o),a(e,r),a(r,i),a(i,p),a(i,y),a(r,g),a(r,b),a(b,C),a(b,d),a(r,k),a(r,T),a(T,P),a(T,N),a(e,f)},p(v,D){D&8&&s!==(s=v[15].name+"")&&X(l,s),D&8&&m!==(m=Re(v[15].pricing.prompt)+"")&&X(y,m),D&8&&E!==(E=Re(v[15].pricing.completion)+"")&&X(d,E),D&8&&I!==(I=Et(v[15].pricing.image)+"")&&X(N,I)},d(v){v&&u(e)}}}function Zt(n){let e,t="系统设置",s,l,o,r,i='<h4 class="svelte-1hnfn98">OpenRouter设置</h4>',p,m,y,g,b="API密钥",C,E,d,k,T,P="保存",I,N,f,v,D='<h4 class="svelte-1hnfn98">管理员账户设置</h4>',z,L,S,O,W,F,H="新用户名",K,j,Y,ee,G,ce="新密码",q,Q,x,fe,le,de,pe="更新信息",ge,me,te,je='<h4 class="svelte-1hnfn98">已保存模型</h4>',ae,se,Ae,be,R=n[1]&&vt(n),ne=n[7]&&mt(n),oe=n[8]&&gt(n),re=n[5]&&bt(n);function Le(ue,$){return ue[3].length===0?Yt:Xt}let Te=Le(n),ie=Te(n);return{c(){e=h("h3"),e.textContent=t,s=V(),l=h("div"),o=h("div"),r=h("div"),r.innerHTML=i,p=V(),m=h("div"),y=h("div"),g=h("label"),g.textContent=b,C=V(),E=h("div"),d=h("input"),k=V(),T=h("button"),T.textContent=P,I=V(),R&&R.c(),N=V(),f=h("div"),v=h("div"),v.innerHTML=D,z=V(),ne&&ne.c(),L=V(),oe&&oe.c(),S=V(),O=h("div"),W=h("div"),F=h("label"),F.textContent=H,K=V(),j=h("input"),Y=V(),ee=h("div"),G=h("label"),G.textContent=ce,q=V(),Q=h("input"),x=V(),re&&re.c(),fe=V(),le=h("div"),de=h("button"),de.textContent=pe,ge=V(),me=h("div"),te=h("div"),te.innerHTML=je,ae=V(),se=h("div"),ie.c(),this.h()},l(ue){e=_(ue,"H3",{"data-svelte-h":!0}),J(e)!=="svelte-pszqt2"&&(e.textContent=t),s=M(ue),l=_(ue,"DIV",{class:!0});var $=w(l);o=_($,"DIV",{class:!0});var ke=w(o);r=_(ke,"DIV",{class:!0,"data-svelte-h":!0}),J(r)!=="svelte-1jtpl4z"&&(r.innerHTML=i),p=M(ke),m=_(ke,"DIV",{class:!0});var De=w(m);y=_(De,"DIV",{class:!0});var Ee=w(y);g=_(Ee,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(g)!=="svelte-1lc0bm2"&&(g.textContent=b),C=M(Ee),E=_(Ee,"DIV",{class:!0});var Pe=w(E);d=_(Pe,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),k=M(Pe),T=_(Pe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(T)!=="svelte-7g9x1g"&&(T.textContent=P),Pe.forEach(u),Ee.forEach(u),I=M(De),R&&R.l(De),De.forEach(u),ke.forEach(u),N=M($),f=_($,"DIV",{class:!0});var Ce=w(f);v=_(Ce,"DIV",{class:!0,"data-svelte-h":!0}),J(v)!=="svelte-tlapiw"&&(v.innerHTML=D),z=M(Ce),ne&&ne.l(Ce),L=M(Ce),oe&&oe.l(Ce),S=M(Ce),O=_(Ce,"DIV",{class:!0});var we=w(O);W=_(we,"DIV",{class:!0});var Ke=w(W);F=_(Ke,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(F)!=="svelte-jguoyo"&&(F.textContent=H),K=M(Ke),j=_(Ke,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),Ke.forEach(u),Y=M(we),ee=_(we,"DIV",{class:!0});var He=w(ee);G=_(He,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(G)!=="svelte-1gp7uve"&&(G.textContent=ce),q=M(He),Q=_(He,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),He.forEach(u),x=M(we),re&&re.l(we),fe=M(we),le=_(we,"DIV",{class:!0});var Ye=w(le);de=_(Ye,"BUTTON",{class:!0,"data-svelte-h":!0}),J(de)!=="svelte-xkne5i"&&(de.textContent=pe),Ye.forEach(u),we.forEach(u),Ce.forEach(u),ge=M($),me=_($,"DIV",{class:!0});var ze=w(me);te=_(ze,"DIV",{class:!0,"data-svelte-h":!0}),J(te)!=="svelte-jg4gyj"&&(te.innerHTML=je),ae=M(ze),se=_(ze,"DIV",{class:!0});var Ze=w(se);ie.l(Ze),Ze.forEach(u),ze.forEach(u),$.forEach(u),this.h()},h(){c(r,"class","card-header svelte-1hnfn98"),c(g,"for","apiKey"),c(g,"class","svelte-1hnfn98"),c(d,"type","password"),c(d,"id","apiKey"),c(d,"placeholder","输入OpenRouter API密钥"),c(d,"class","input svelte-1hnfn98"),c(T,"class","btn success svelte-1hnfn98"),c(E,"class","input-group svelte-1hnfn98"),c(y,"class","form-group svelte-1hnfn98"),c(m,"class","card-content"),c(o,"class","settings-card svelte-1hnfn98"),c(v,"class","card-header svelte-1hnfn98"),c(F,"for","newUsername"),c(F,"class","svelte-1hnfn98"),c(j,"type","text"),c(j,"id","newUsername"),c(j,"placeholder","输入新用户名（可选）"),c(j,"class","input svelte-1hnfn98"),c(W,"class","form-group svelte-1hnfn98"),c(G,"for","newPassword"),c(G,"class","svelte-1hnfn98"),c(Q,"type","password"),c(Q,"id","newPassword"),c(Q,"placeholder","输入新密码（可选）"),c(Q,"class","input svelte-1hnfn98"),c(ee,"class","form-group svelte-1hnfn98"),c(de,"class","btn success svelte-1hnfn98"),c(le,"class","button-group svelte-1hnfn98"),c(O,"class","card-content"),c(f,"class","settings-card svelte-1hnfn98"),c(te,"class","card-header svelte-1hnfn98"),c(se,"class","card-content"),c(me,"class","settings-card svelte-1hnfn98"),c(l,"class","settings-container svelte-1hnfn98")},m(ue,$){A(ue,e,$),A(ue,s,$),A(ue,l,$),a(l,o),a(o,r),a(o,p),a(o,m),a(m,y),a(y,g),a(y,C),a(y,E),a(E,d),he(d,n[0]),a(E,k),a(E,T),a(m,I),R&&R.m(m,null),a(l,N),a(l,f),a(f,v),a(f,z),ne&&ne.m(f,null),a(f,L),oe&&oe.m(f,null),a(f,S),a(f,O),a(O,W),a(W,F),a(W,K),a(W,j),he(j,n[4]),a(O,Y),a(O,ee),a(ee,G),a(ee,q),a(ee,Q),he(Q,n[5]),a(O,x),re&&re.m(O,null),a(O,fe),a(O,le),a(le,de),a(l,ge),a(l,me),a(me,te),a(me,ae),a(me,se),ie.m(se,null),Ae||(be=[Z(d,"input",n[10]),Z(T,"click",function(){Ct(n[2])&&n[2].apply(this,arguments)}),Z(j,"input",n[11]),Z(Q,"input",n[12]),Z(de,"click",n[9])],Ae=!0)},p(ue,[$]){n=ue,$&1&&d.value!==n[0]&&he(d,n[0]),n[1]?R?R.p(n,$):(R=vt(n),R.c(),R.m(m,null)):R&&(R.d(1),R=null),n[7]?ne?ne.p(n,$):(ne=mt(n),ne.c(),ne.m(f,L)):ne&&(ne.d(1),ne=null),n[8]?oe?oe.p(n,$):(oe=gt(n),oe.c(),oe.m(f,S)):oe&&(oe.d(1),oe=null),$&16&&j.value!==n[4]&&he(j,n[4]),$&32&&Q.value!==n[5]&&he(Q,n[5]),n[5]?re?re.p(n,$):(re=bt(n),re.c(),re.m(O,fe)):re&&(re.d(1),re=null),Te===(Te=Le(n))&&ie?ie.p(n,$):(ie.d(1),ie=Te(n),ie&&(ie.c(),ie.m(se,null)))},i:_e,o:_e,d(ue){ue&&(u(e),u(s),u(l)),R&&R.d(),ne&&ne.d(),oe&&oe.d(),re&&re.d(),ie.d(),Ae=!1,Ie(be)}}}function Re(n){return`$${(parseFloat(n)*1e6).toFixed(2)}/1M tokens`}function Et(n){if(!n)return"不支持图片生成";const e=parseFloat(n);return isNaN(e)?"不支持图片生成":`$${(e*1e3).toFixed(2)}/K imgs`}function xt(n,e,t){let{apiKey:s}=e,{apiKeyMessage:l}=e,{onSaveApiKey:o}=e,{savedModels:r}=e,i="",p="",m="",y="",g="";async function b(P,I={}){const f={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},v=await fetch(P,{...I,headers:{...f,...I.headers}});if(v.status===401)throw Ve("/bde"),new Error("未认证");return v}async function C(){try{if(p&&p!==m){t(8,g="两次输入的密码不一致");return}if(!i&&!p){t(8,g="请至少输入新用户名或新密码");return}const P=await b("/api/settings/admin",{method:"POST",body:JSON.stringify({new_username:i||void 0,new_password:p||void 0})});if(!P.ok){const I=await P.json();throw new Error(I.error||"更新失败")}t(7,y="管理员信息更新成功"),t(8,g=""),t(4,i=""),t(5,p=""),t(6,m=""),i&&setTimeout(()=>{localStorage.removeItem("auth_token"),Ve("/bde")},2e3)}catch(P){console.error("更新管理员信息错误:",P),t(8,g=P instanceof Error?P.message:"更新失败"),t(7,y="")}}function E(){s=this.value,t(0,s)}function d(){i=this.value,t(4,i)}function k(){p=this.value,t(5,p)}function T(){m=this.value,t(6,m)}return n.$$set=P=>{"apiKey"in P&&t(0,s=P.apiKey),"apiKeyMessage"in P&&t(1,l=P.apiKeyMessage),"onSaveApiKey"in P&&t(2,o=P.onSaveApiKey),"savedModels"in P&&t(3,r=P.savedModels)},[s,l,o,r,i,p,m,y,g,C,E,d,k,T]}class $t extends Be{constructor(e){super(),Oe(this,e,xt,Zt,Ue,{apiKey:0,apiKeyMessage:1,onSaveApiKey:2,savedModels:3})}}function es(n){let e,t;return e=new Gt({}),{c(){Fe(e.$$.fragment)},l(s){Je(e.$$.fragment,s)},m(s,l){Qe(e,s,l),t=!0},p:_e,i(s){t||(Se(e.$$.fragment,s),t=!0)},o(s){Ne(e.$$.fragment,s),t=!1},d(s){We(e,s)}}}function ts(n){let e,t;return e=new qt({}),{c(){Fe(e.$$.fragment)},l(s){Je(e.$$.fragment,s)},m(s,l){Qe(e,s,l),t=!0},p:_e,i(s){t||(Se(e.$$.fragment,s),t=!0)},o(s){Ne(e.$$.fragment,s),t=!1},d(s){We(e,s)}}}function ss(n){let e,t;return e=new Lt({props:{models:n[0],loading:n[5],error:n[6],savedModelIds:n[1],modelMessage:n[7],searchQuery:rs,onRefresh:n[12],onToggleModel:n[11]}}),{c(){Fe(e.$$.fragment)},l(s){Je(e.$$.fragment,s)},m(s,l){Qe(e,s,l),t=!0},p(s,l){const o={};l&1&&(o.models=s[0]),l&32&&(o.loading=s[5]),l&64&&(o.error=s[6]),l&2&&(o.savedModelIds=s[1]),l&128&&(o.modelMessage=s[7]),e.$set(o)},i(s){t||(Se(e.$$.fragment,s),t=!0)},o(s){Ne(e.$$.fragment,s),t=!1},d(s){We(e,s)}}}function ls(n){let e,t;return e=new $t({props:{apiKey:n[3],apiKeyMessage:n[4],savedModels:n[9],onSaveApiKey:n[10]}}),{c(){Fe(e.$$.fragment)},l(s){Je(e.$$.fragment,s)},m(s,l){Qe(e,s,l),t=!0},p(s,l){const o={};l&8&&(o.apiKey=s[3]),l&16&&(o.apiKeyMessage=s[4]),l&512&&(o.savedModels=s[9]),e.$set(o)},i(s){t||(Se(e.$$.fragment,s),t=!0)},o(s){Ne(e.$$.fragment,s),t=!1},d(s){We(e,s)}}}function ns(n){let e,t,s,l,o,r="管理员仪表板",i,p,m,y,g,b,C,E="系统设置",d,k,T="模型列表",P,I,N="用户列表",f,v,D="VIP激活码",z,L,S="注销",O,W,F,H,K,j,Y;const ee=[ls,ss,ts,es],G=[];function ce(q,Q){return q[8]==="settings"?0:q[8]==="models"?1:q[8]==="users"?2:q[8]==="vip"?3:-1}return~(F=ce(n))&&(H=G[F]=ee[F](n)),{c(){e=h("div"),t=h("div"),s=h("aside"),l=h("div"),o=h("h2"),o.textContent=r,i=V(),p=h("div"),m=U("欢迎, "),y=U(n[2]),g=V(),b=h("div"),C=h("button"),C.textContent=E,d=V(),k=h("button"),k.textContent=T,P=V(),I=h("button"),I.textContent=N,f=V(),v=h("button"),v.textContent=D,z=V(),L=h("button"),L.textContent=S,O=V(),W=h("main"),H&&H.c(),this.h()},l(q){e=_(q,"DIV",{class:!0});var Q=w(e);t=_(Q,"DIV",{class:!0});var x=w(t);s=_(x,"ASIDE",{class:!0});var fe=w(s);l=_(fe,"DIV",{class:!0});var le=w(l);o=_(le,"H2",{"data-svelte-h":!0}),J(o)!=="svelte-i8y5wy"&&(o.textContent=r),i=M(le),p=_(le,"DIV",{class:!0});var de=w(p);m=B(de,"欢迎, "),y=B(de,n[2]),de.forEach(u),le.forEach(u),g=M(fe),b=_(fe,"DIV",{class:!0});var pe=w(b);C=_(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(C)!=="svelte-1ghdoer"&&(C.textContent=E),d=M(pe),k=_(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(k)!=="svelte-fx40jm"&&(k.textContent=T),P=M(pe),I=_(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(I)!=="svelte-1yh0max"&&(I.textContent=N),f=M(pe),v=_(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(v)!=="svelte-1ix8j64"&&(v.textContent=D),pe.forEach(u),z=M(fe),L=_(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),J(L)!=="svelte-1cnn1zj"&&(L.textContent=S),fe.forEach(u),O=M(x),W=_(x,"MAIN",{class:!0});var ge=w(W);H&&H.l(ge),ge.forEach(u),x.forEach(u),Q.forEach(u),this.h()},h(){c(p,"class","welcome-badge"),c(l,"class","sidebar-header"),c(C,"class","sidebar-btn"),ve(C,"active",n[8]==="settings"),c(k,"class","sidebar-btn"),ve(k,"active",n[8]==="models"),c(I,"class","sidebar-btn"),ve(I,"active",n[8]==="users"),c(v,"class","sidebar-btn"),ve(v,"active",n[8]==="vip"),c(b,"class","sidebar-nav"),c(L,"class","sidebar-btn logout-btn"),c(s,"class","dashboard-sidebar"),c(W,"class","dashboard-content"),c(t,"class","dashboard-layout"),c(e,"class","dashboard-container")},m(q,Q){A(q,e,Q),a(e,t),a(t,s),a(s,l),a(l,o),a(l,i),a(l,p),a(p,m),a(p,y),a(s,g),a(s,b),a(b,C),a(b,d),a(b,k),a(b,P),a(b,I),a(b,f),a(b,v),a(s,z),a(s,L),a(t,O),a(t,W),~F&&G[F].m(W,null),K=!0,j||(Y=[Z(C,"click",n[14]),Z(k,"click",n[15]),Z(I,"click",n[16]),Z(v,"click",n[17]),Z(L,"click",n[13])],j=!0)},p(q,[Q]){(!K||Q&4)&&X(y,q[2]),(!K||Q&256)&&ve(C,"active",q[8]==="settings"),(!K||Q&256)&&ve(k,"active",q[8]==="models"),(!K||Q&256)&&ve(I,"active",q[8]==="users"),(!K||Q&256)&&ve(v,"active",q[8]==="vip");let x=F;F=ce(q),F===x?~F&&G[F].p(q,Q):(H&&(It(),Ne(G[x],1,1,()=>{G[x]=null}),yt()),~F?(H=G[F],H?H.p(q,Q):(H=G[F]=ee[F](q),H.c()),Se(H,1),H.m(W,null)):H=null)},i(q){K||(Se(H),K=!0)},o(q){Ne(H),K=!1},d(q){q&&u(e),~F&&G[F].d(),j=!1,Ie(Y)}}}let rs="";function as(){return{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}function os(n,e,t){let s,l="",o="",r="",i=[],p=!1,m=null,y=[],g="",b="settings";async function C(v,D={}){const z=as(),L=await fetch(v,{...D,headers:{...z,...D.headers}});if(L.status===401)throw Ve("/bde"),new Error("未认证");return L}Ge(async()=>{try{const v=await C("/api/check-admin");if(!v.ok){Ve("/bde");return}const D=await v.json();t(2,l=D.username);const z=await C("/api/settings/openrouter-key");if(z.ok){const S=await z.json();S.api_key&&(t(3,o=S.api_key),await k())}const L=await C("/api/settings/saved-models");if(L.ok){const S=await L.json();S.model_ids&&t(1,y=S.model_ids)}}catch(v){console.error("认证错误:",v),Ve("/bde")}});async function E(){try{if(!(await C("/api/settings/openrouter-key",{method:"POST",body:JSON.stringify({api_key:o})})).ok)throw new Error("保存API密钥失败");t(4,r="API密钥已保存"),await k(),setTimeout(()=>{t(4,r="")},3e3)}catch(v){console.error("保存API密钥错误:",v),t(4,r="保存API密钥失败")}}async function d(v){try{const D=await C("/api/settings/saved-models",{method:"POST",body:JSON.stringify({model_ids:v,models:i})});if(!D.ok){const z=await D.json();throw new Error(z.error||"保存模型失败")}t(1,y=v),t(7,g="模型已更新"),setTimeout(()=>{t(7,g="")},3e3)}catch(D){console.error("保存模型错误:",D),t(7,g=D instanceof Error?D.message:"保存模型失败")}}async function k(){try{t(5,p=!0),t(6,m=null);const v=await C("/api/models");if(!v.ok){const z=await v.text();throw console.error("获取模型失败:",z),new Error("获取模型列表失败")}const D=await v.json();if(!Array.isArray(D))throw new Error("获取到的模型数据格式不正确");t(0,i=D)}catch(v){console.error("获取模型错误:",v),t(6,m=v instanceof Error?v.message:"未知错误")}finally{t(5,p=!1)}}function T(){localStorage.removeItem("auth_token"),Ve("/bde")}const P=()=>t(8,b="settings"),I=()=>t(8,b="models"),N=()=>t(8,b="users"),f=()=>t(8,b="vip");return n.$$.update=()=>{n.$$.dirty&3&&t(9,s=i.filter(v=>y.includes(v.id)).sort((v,D)=>v.name.localeCompare(D.name)))},[i,y,l,o,r,p,m,g,b,s,E,d,k,T,P,I,N,f]}class ds extends Be{constructor(e){super(),Oe(this,e,os,ns,Ue,{})}}export{ds as component};

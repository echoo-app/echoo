import{s as ee,n as Q,r as te}from"../chunks/scheduler.BvLojk_z.js";import{S as se,i as le,e as p,s as O,b as X,c as f,d as E,m as H,h as S,g as _,f as Y,n as t,j as Z,k as l,p as A,q as M,r as ae,l as $}from"../chunks/index.cf6qNKHt.js";import{g as oe}from"../chunks/entry.7PKGXZch.js";function W(n){let a,e;return{c(){a=p("div"),e=X(n[2]),this.h()},l(s){a=f(s,"DIV",{class:!0});var u=E(a);e=Y(u,n[2]),u.forEach(_),this.h()},h(){t(a,"class","error-message svelte-17x3c1c")},m(s,u){Z(s,a,u),l(a,e)},p(s,u){u&4&&$(e,s[2])},d(s){s&&_(a)}}}function re(n){let a,e,s,u="管理员登录",w,y,C,h,g,i,V="用户名",v,o,B,k,I,z="密码",P,d,J,x,b,L=n[3]?"登录中...":"登录",N,U,F,c=n[2]&&W(n);return{c(){a=p("div"),e=p("div"),s=p("h2"),s.textContent=u,w=O(),c&&c.c(),y=O(),C=p("form"),h=p("div"),g=p("div"),i=p("label"),i.textContent=V,v=O(),o=p("input"),B=O(),k=p("div"),I=p("label"),I.textContent=z,P=O(),d=p("input"),J=O(),x=p("div"),b=p("button"),N=X(L),this.h()},l(r){a=f(r,"DIV",{class:!0});var m=E(a);e=f(m,"DIV",{class:!0});var T=E(e);s=f(T,"H2",{class:!0,"data-svelte-h":!0}),H(s)!=="svelte-nsheot"&&(s.textContent=u),w=S(T),c&&c.l(T),y=S(T),C=f(T,"FORM",{});var R=E(C);h=f(R,"DIV",{class:!0});var D=E(h);g=f(D,"DIV",{class:!0});var j=E(g);i=f(j,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),H(i)!=="svelte-sw7e36"&&(i.textContent=V),v=S(j),o=f(j,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),j.forEach(_),B=S(D),k=f(D,"DIV",{class:!0});var q=E(k);I=f(q,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),H(I)!=="svelte-1ehyycy"&&(I.textContent=z),P=S(q),d=f(q,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),q.forEach(_),J=S(D),x=f(D,"DIV",{class:!0});var G=E(x);b=f(G,"BUTTON",{type:!0,class:!0});var K=E(b);N=Y(K,L),K.forEach(_),G.forEach(_),D.forEach(_),R.forEach(_),T.forEach(_),m.forEach(_),this.h()},h(){t(s,"class","svelte-17x3c1c"),t(i,"for","username"),t(i,"class","svelte-17x3c1c"),t(o,"type","text"),t(o,"id","username"),t(o,"placeholder","请输入用户名"),o.required=!0,o.disabled=n[3],t(o,"class","svelte-17x3c1c"),t(g,"class","input-group svelte-17x3c1c"),t(I,"for","password"),t(I,"class","svelte-17x3c1c"),t(d,"type","password"),t(d,"id","password"),t(d,"placeholder","请输入密码"),d.required=!0,d.disabled=n[3],t(d,"class","svelte-17x3c1c"),t(k,"class","input-group svelte-17x3c1c"),t(b,"type","submit"),t(b,"class","login-btn svelte-17x3c1c"),b.disabled=n[3],t(x,"class","button-group svelte-17x3c1c"),t(h,"class","input-wrapper svelte-17x3c1c"),t(e,"class","login-box svelte-17x3c1c"),t(a,"class","login-container svelte-17x3c1c")},m(r,m){Z(r,a,m),l(a,e),l(e,s),l(e,w),c&&c.m(e,null),l(e,y),l(e,C),l(C,h),l(h,g),l(g,i),l(g,v),l(g,o),A(o,n[0]),l(h,B),l(h,k),l(k,I),l(k,P),l(k,d),A(d,n[1]),l(h,J),l(h,x),l(x,b),l(b,N),U||(F=[M(o,"input",n[5]),M(d,"input",n[6]),M(C,"submit",ae(n[4]))],U=!0)},p(r,[m]){r[2]?c?c.p(r,m):(c=W(r),c.c(),c.m(e,y)):c&&(c.d(1),c=null),m&8&&(o.disabled=r[3]),m&1&&o.value!==r[0]&&A(o,r[0]),m&8&&(d.disabled=r[3]),m&2&&d.value!==r[1]&&A(d,r[1]),m&8&&L!==(L=r[3]?"登录中...":"登录")&&$(N,L),m&8&&(b.disabled=r[3])},i:Q,o:Q,d(r){r&&_(a),c&&c.d(),U=!1,te(F)}}}function ne(n,a,e){let s="",u="",w="",y=!1;async function C(){try{e(3,y=!0),e(2,w=""),console.log("发送登录请求:",{username:s});const i=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:s,password:u}),credentials:"same-origin"});console.log("登录响应状态:",i.status),console.log("登录响应头:",Object.fromEntries(i.headers));const V=await i.text();console.log("原始响应:",V);let v;try{v=JSON.parse(V)}catch(o){throw console.error("JSON解析错误:",o),new Error("服务器响应格式错误")}i.ok?(console.log("登录成功:",v),v.token&&(localStorage.setItem("auth_token",v.token),new Headers().append("Authorization",`Bearer ${v.token}`),console.log("Token已保存:",v.token)),oe("/bde/dashboard")):(console.error("登录失败:",v),e(2,w=v.message||"登录失败"))}catch(i){console.error("登录错误:",i),e(2,w=i.message||"网络错误，请重试")}finally{e(3,y=!1)}}function h(){s=this.value,e(0,s)}function g(){u=this.value,e(1,u)}return[s,u,w,y,C,h,g]}class de extends se{constructor(a){super(),le(this,a,ne,re,ee,{})}}export{de as component};
